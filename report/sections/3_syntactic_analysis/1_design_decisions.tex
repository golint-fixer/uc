\subsection{Design Decisions}

foo

\subsubsection{Postpone Type Checking}

% To simplify the design of the parser and the parser generator, I suggest we postpone the type checking to the semantic analysis phase. This design decision would be supported by the KISS mentality, let each component focus on one thing, and do it well.

% Alex, what are your thoughts? We could go either direction, and for uC it would be trivial to enforce type checking already in the parser. My main concern is that such an approach could make the parser sufficiently more complex in the future, once we start supporting a larger subset of C.

% If we were to postpone the type checking to the semantic analysis phase, it should be possible to merge VarDecl and ParamDecl production rules, and let the type checker validate their uses within function signatures and bodies.

% `void x[10];` is a valid array declaration during parsing, and would be marked as invalid during the semantic analysis.

foo

\footnote{Postpone type checking to the semantic analysis phase: \url{https://github.com/mewmew/uc/issues/33}}

\subsubsection{Ignore Comments to Simplify Grammar}

% Having comment tokens emitted by the lexer into the stream of tokens, presents an issue when parsing source files; as the current grammar does not handle comments within its production rules.
%
% Two approaches for resolving this issue have been identified
%
%     Add comments to the production rules.
%         Pros: makes it easier to write tools such as indent and doxygen which requires preservation of position accurate comments, and hopefully attached to their corresponding node within the AST.
%         Cons: makes the grammar much more verbose, as a comment can exist virtually between any two given tokens.
%     Ignore comments when lexing the source file.
%         Pros: simplifies the grammar.
%         Cons: does not facilitate the development of source code rewriting and documentation generation tools.
%
% For the time being, the second approach has been implemented. This decision may be revisited once the parser has matured to correctly handle the syntactic elements of uC.

% The second approach has been implemented in commit 1488a8a, closing for now. Re-open this topic in the future, when trying to tackle the first approach.

foo

\footnote{Production rules made more complex by comment tokens: \url{https://github.com/mewmew/uc/issues/30}}

\subsubsection{Unify Declarations}

% // TODO: Evaluate whether TopLevelDecl should be merged with Decl, to simplify
% // the structure of the AST; in which case a semantic analysis pass would be
% // added to ensure that function declarations are not nested (even if this would
% // be an interesting extension to C).

% After discussions, we've decided to remove the TopLevelDecl special case and make function declarations behave like any other declaration. This should simplify the grammar and the AST, while semantic checks should be added to ensure that declarations within functions are not function declarations (unless the GNU extension of nested functions is enabled; see issue #43).

% TopLevelDecl and Decl were merged in commit 3db3068. Closing this issue.

foo

\footnote{Evaluate merging TopLevelDecl with Decl to simplify grammar: \url{https://github.com/mewmew/uc/issues/38}}

foo

% Example source file containing nested functions.
%
% int main() {
%     int f(int a, int b) {
%         return a+b;
%     }
%     return f(2,3);
% }
%
% Compilation using GCC.
%
% u@x1 ~/Desktop> gcc -std=c99 -pedantic -o a a.c
% a.c: In function ‘main’:
% a.c:2:2: warning: ISO C forbids nested functions [-Wpedantic]
%   int f(int a, int b) {
%   ^
% u@x1 ~/Desktop> ./a ; echo $status
% 5
% u@x1 ~/Desktop>
%
% Clang has intentionally omitted support for nested functions:
%
%     clang does not support nested functions; this is a complex feature which is infrequently used, so it is unlikely to be implemented anytime soon. In C++11 it can be emulated by assigning lambda functions to local variables.
%
% Motivation
%
% Adding support for nested functions would simplify the grammar and allow the TopLevelDecl special case to be removed, as functions would be considered regular declarations (see issue #38).

% Code generation for nested functions is considered a future ambition of this project. Closing this issue for now.

\footnote{Add support for nested functions (GNU extension): \url{https://github.com/mewmew/uc/issues/43}}
